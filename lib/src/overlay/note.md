
## Overlay 浮层

子菜单交互行为:
- x a. active true 时打开子菜单
- x 触发 a 时, 关闭所有其他同级或更下级的子菜单
  x点击任意菜单之外关闭所有菜单，点击 esc 关闭所有菜单
- x 点击时选中项

菜单实现:
- x 通过 ZoOptionBase > ZoOption 渲染 list
- x 菜单可限制最大高度, 默认与窗口等高
- x 支持级联
  - 父子菜单通过 child parent 关联
  - 每个层级只需创建一个overlay实例并复用
- x 支持异步级联
  - 复用管理子项异步加载的数据
- x 如果菜单方向被flip, 后续都以该方向显示
- x 每个子菜单单独设置尺寸

TODO:
- x 选中标记，树形数据建模
- x 点击esc关闭所有相关菜单
- x 按键交互
- Select
- Tree
- 小屏兼容处理

小屏兼容: 小屏设备转为使用 tree 展示

上层组件:
- Menu:  核心, 通过 OverlayEntry 实现
- Select: 上层组件, 组合了 MenuEntry 和  Input, 支持多选 / 单选 / chip / 筛选等 
- Tree

按键交互:
active状态, 此状态高亮并显示子菜单
- cmd + a 如果启用了多选, 进行全选 / 反选
- x 上下健 + tap 使用内置的焦点移动逻辑
- x 聚焦行为变更，改为手动控制层合适获得焦点，顶级层打开时获得焦点
- x 分支节点获得焦点时, 延迟打开层
- x 左右键移动焦点到相邻的层
  - 如果层未打开将其打开
  - 如果是移动到更小的层, 将其后的层关闭, 子菜单需要获取实时方向来判断顺序

ZoOption:
- x 通用的 ZoOption 类, 表示 select menu tree 等组件的选项,  支持 disabled  active  title  desc  leading trailing  children  divider builder 等, 这能更好的做到限制高度来实现滚动优化

杂项:
- x 异步加载选项: optionsLoader / optionsLoaderFinished
- x 所选选中/高亮等状态存储在顶层 overlay
- x 筛选
- x 预置工具条, 包括筛选框

性能优化:
- x 滚动中不触发子项展开
- x 快速移动时不触发子项展开

选择支持:
- x 选中回调通知: onSelected
- x 单选 / 多选支持
- x 选中后自动关闭: 单选且命中叶子节点时启用, 也可以强制开启
- x 叶子节点是否可选中 = false
- x ~~父子级关联选中~~ 这应该在逻辑上成立而不是视觉上, 子项选中就应视为父项也被选中, 反之亦然
- ~~包含被选中项的分支节点显示选中数量~~
- x 标记包含选中子级项的父级: 通过某种缓存建立机制实现, 可快速根据一个项获取其所有父级?
  - x 快速获取节点的父级 / 层级 / 索引 / 扁平化列表 / 节点本身的引用 / 前后一个节点 / 后代数量 / 是否是兄弟节点的第一个/最后一个
  - x TreeHelper
  - x 对整个树建模
  - x 对有变更的节点及其子级建模? 可能比较难
  - x 按需处理信息

